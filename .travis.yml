language: python

os: 
  - linux
  - osx

python:
  - "3.6.3"

dist: trusty
sudo: required
sudo: true

before_install:
  - if [[ "$TRAVIS_OS_NAME" == "osx" ]]; then 
      export PATH=/usr/local/bin:/usr/local/sbin:$PATH
      brew upgrade python ;
    else
      sudo apt-get update -qq
      sudo apt-get install lsb-core
      sudo apt-get install ocl-icd-opencl-dev -y
      wget http://registrationcenter-download.intel.com/akdlm/irc_nas/12556/opencl_runtime_16.1.2_x64_rh_6.4.0.37.tgz
      tar -xvzf opencl_runtime_16.1.2_x64_rh_6.4.0.37.tgz
      cd opencl_runtime_16.1.2_x64_rh_6.4.0.37
      sudo ./install.sh -s ../travisci/intelOpenCLSilent.cfg
      cd ..
      sudo ldconfig
    fi

  - pip3 install numpy

# Compiler selection
compiler:
  - gcc

# Build steps
script:
  - mkdir build
  - cd build
  - cmake .. && make && ctest --verbose
  - cd Release/tests
  - python3 sodecl_python_tests.py